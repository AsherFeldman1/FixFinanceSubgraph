import { clearStore, test, assert } from "matchstick-as/assembly/index"
import { logStore } from "matchstick-as/assembly/store"
import { log } from "matchstick-as/assembly/log"
import { handleWrapperDeployment, handleFCPdeployment, handleOrderbookDeployment } from "../src/Main/HandleDeployments"
import { User } from "../generated/schema"
import { newWrapper, newFCP, newOrderBook } from "./testUtils"

test("deploy wrapper", () => {
	let newWrapperEvent = newWrapper(
			"0x0000000000000000000000000000000000000001",
			"0x0000000000000000000000000000000000000002",
			"0x0000000000000000000000000000000000000003",
			1
		)
	handleWrapperDeployment(newWrapperEvent)
	assert.fieldEquals("WrapperAsset", "0x0000000000000000000000000000000000000001", "id", "0x0000000000000000000000000000000000000001")
	assert.fieldEquals("WrapperAsset", "0x0000000000000000000000000000000000000001", "Owner", "0x0000000000000000000000000000000000000003")
	assert.fieldEquals("WrapperAsset", "0x0000000000000000000000000000000000000001", "UnderlyingAsset", "0x0000000000000000000000000000000000000002")
	assert.fieldEquals("WrapperAsset", "0x0000000000000000000000000000000000000001", "Supply", "0")
	assert.fieldEquals("WrapperAsset", "0x0000000000000000000000000000000000000001", "WrapperType", "1")
	assert.fieldEquals("User", "0x0000000000000000000000000000000000000003", "id", "0x0000000000000000000000000000000000000003")
	assert.fieldEquals("User", "0x0000000000000000000000000000000000000003", "WrappersCreated", "[]")
	assert.fieldEquals("User", "0x0000000000000000000000000000000000000003", "Vaults", "[]")
	clearStore()
})

test("deploy FCP", () => {
	let newFCPEvent = newFCP(
		"0x0000000000000000000000000000000000000001",
		"0x0000000000000000000000000000000000000002",
		"0x0000000000000000000000000000000000000003",
		1
	)
	handleFCPdeployment(newFCPEvent)
	assert.fieldEquals("FCP", "0x0000000000000000000000000000000000000001", "id", "0x0000000000000000000000000000000000000001")
	assert.fieldEquals("FCP", "0x0000000000000000000000000000000000000001", "Wrapper", "0x0000000000000000000000000000000000000002")
	assert.fieldEquals("FCP", "0x0000000000000000000000000000000000000001", "Owner", "0x0000000000000000000000000000000000000003")
	assert.fieldEquals("FCP", "0x0000000000000000000000000000000000000001", "Maturity", "1")
	assert.fieldEquals("User", "0x0000000000000000000000000000000000000003", "id", "0x0000000000000000000000000000000000000003")
})

test("deploy OrderBook", () => {
	let newBookEvent = newOrderBook(
		"0x0000000000000000000000000000000000000002",
		"0x0000000000000000000000000000000000000001",
	)
	handleOrderbookDeployment(newBookEvent)
	assert.fieldEquals("Orderbook", "0x0000000000000000000000000000000000000002", "id", "0x0000000000000000000000000000000000000002")
	assert.fieldEquals("Orderbook", "0x0000000000000000000000000000000000000002", "Pool", "0x0000000000000000000000000000000000000001")
	assert.fieldEquals("Orderbook", "0x0000000000000000000000000000000000000002", "YTsellHead", "")
	clearStore()
})